"""Functions for understanding and creating signal names."""
import covidcast

def add_prefix(signal_names, wip_signal, prefix="wip_"):
    """Add prefix to signal if there is a WIP signal.

    Parameters
    ----------
    signal_names: List[str]
        Names of signals to be exported
    prefix : "wip_"
        prefix for new/non public signals
    wip_signal : List[str] or bool
        a list of wip signals: [], OR
        all signals in the registry: True OR
        only signals that have never been published: False
    Returns
    -------
    List of signal names
        wip/non wip signals for further computation
    """
    if wip_signal is True:
        return [prefix + signal for signal in signal_names]
    if isinstance(wip_signal, list):
        make_wip = set(wip_signal)
        return [
            (prefix if signal in make_wip else "") + signal
            for signal in signal_names
        ]
    if wip_signal in {False, ""}:
        return [
            signal if public_signal(signal)
            else prefix + signal
            for signal in signal_names
        ]
    raise ValueError("Supply True | False or '' or [] | list()")


def public_signal(signal):
    """Check if the signal name is already public using COVIDcast.

    Parameters
    ----------
    signal : str
        Name of the signal
    Returns
    -------
    bool
        True if the signal is present
        False if the signal is not present
    """
    epidata_df = covidcast.metadata()
    for index in range(len(epidata_df)):
        if epidata_df["signal"][index] == signal:
            return True
    return False
