## Functions to rename, reformat, and recode responses in the raw input data for
## use in contingency tables, called from `load_response_one`. Since these are
## called in `load_response_one`, which reads one specific Qualtrics file, their
## input data is always from only one wave of the survey -- they do not deal
## with inputs that have multiple waves mingled in one data frame.

#' Gender
#'
#' @param input_data input data frame of raw survey data
#' @param wave integer indicating survey version
#' 
#' @return augmented data frame
code_gender <- function(input_data, wave) {
  if ("D1" %in% names(input_data)) {
    input_data$gender <- case_when(
      input_data$D1 == 1 ~ "Male",
      input_data$D1 == 2 ~ "Female",
      input_data$D1 == 3 ~ "Other",
      input_data$D1 == 4 ~ "Other",
      input_data$D1 == 5 ~ NA_character_,
      TRUE ~ NA_character_
    )
  } else {
    input_data$gender <- NA_character_
  }
  
  return(input_data)
}

#' Age-related fields
#'
#' @param input_data input data frame of raw survey data
#' @param wave integer indicating survey version
#' 
#' @return augmented data frame
code_age <- function(input_data, wave) {
  if ("D2" %in% names(input_data)) {
    input_data$agefull <- case_when(
      input_data$D2 == 1 ~ "18-24",
      input_data$D2 == 2 ~ "25-34",
      input_data$D2 == 3 ~ "35-44",
      input_data$D2 == 4 ~ "45-54",
      input_data$D2 == 5 ~ "55-64",
      input_data$D2 == 6 ~ "65-74",
      input_data$D2 == 7 ~ "75plus",
      TRUE ~ NA_character_
    )
    
    # Condensed age categories
    input_data$age <- case_when(
      input_data$D2 == 1 ~ "18-24",
      input_data$D2 == 2 ~ "25-44",
      input_data$D2 == 3 ~ "25-44",
      input_data$D2 == 4 ~ "45-64",
      input_data$D2 == 5 ~ "45-64",
      input_data$D2 == 6 ~ "65plus",
      input_data$D2 == 7 ~ "65plus",
      TRUE ~ NA_character_
    )
    
    input_data$age65plus <- input_data$age == "65plus"
  } else {
    input_data$agefull <- NA_character_
    input_data$age <- NA_character_
    input_data$age65plus <- NA
  }
  
  return(input_data)
}

#' Occupation
#'
#' @param input_data input data frame of raw survey data
#' @param wave integer indicating survey version
#' 
#' @return augmented data frame
code_occupation <- function(input_data, wave) {
  if ("Q64" %in% names(input_data)) {
    input_data$healthcareworker <-
      input_data$Q64 == 5 |
      input_data$Q64 == 4
  } else {
    input_data$healthcareworker <- NA
  }
  
  if ("Q64" %in% names(input_data)) {
    input_data$occupation <- case_when(
      input_data$Q64 == 1 ~ "SocialService",
      input_data$Q64 == 2 ~ "Education",
      input_data$Q64 == 3 ~ "Arts",
      input_data$Q64 == 4 ~ "HealthcarePractitioner",
      input_data$Q64 == 5 ~ "HealthcareSupport",
      input_data$Q64 == 6 ~ "ProtectiveService",
      input_data$Q64 == 7 ~ "FoodService",
      input_data$Q64 == 8 ~ "BuildingMaintenance",
      input_data$Q64 == 9 ~ "PersonalCare",
      input_data$Q64 == 10 ~ "Sales",
      input_data$Q64 == 11 ~ "Office",
      input_data$Q64 == 12 ~ "Construction",
      input_data$Q64 == 13 ~ "Maintenance",
      input_data$Q64 == 14 ~ "Production",
      input_data$Q64 == 15 ~ "Transportation",
      input_data$Q64 == 16 ~ "Other",
      TRUE ~ NA_character_
    )
  } else {
    input_data$occupation <- NA_character_
  }
  
  return(input_data)
}

#' Education
#'
#' @param input_data input data frame of raw survey data
#' @param wave integer indicating survey version
#' 
#' @return augmented data frame
code_education <- function(input_data, wave) {
  if ("D8" %in% names(input_data)) {
    input_data$edulevelfull <- case_when(
      input_data$D8 == 1 ~ "LessThanHighSchool",
      input_data$D8 == 2 ~ "HighSchool",
      input_data$D8 == 3 ~ "SomeCollege",
      input_data$D8 == 4 ~ "TwoYearDegree",
      input_data$D8 == 5 ~ "FourYearDegree",
      input_data$D8 == 8 ~ "MastersDegree",
      input_data$D8 == 6 ~ "ProfessionalDegree",
      input_data$D8 == 7 ~ "Doctorate",
      TRUE ~ NA_character_
    )
    
    input_data$edulevel <- case_when(
      input_data$D8 == 1 ~ "LessThanHighSchool",
      input_data$D8 == 2 ~ "HighSchool",
      input_data$D8 == 3 ~ "SomeCollege",
      input_data$D8 == 4 ~ "SomeCollege",
      input_data$D8 == 5 ~ "FourYearDegree",
      input_data$D8 == 8 ~ "PostGraduate",
      input_data$D8 == 6 ~ "PostGraduate",
      input_data$D8 == 7 ~ "PostGraduate",
      TRUE ~ NA_character_
    )
  } else {
    input_data$edulevelfull <- NA_character_
    input_data$edulevel <- NA_character_
  }
  
  return(input_data)
}

#' Health conditions and behaviors
#'
#' @param input_data input data frame of raw survey data
#' @param wave integer indicating survey version
#' 
#' @return augmented data frame
code_health <- function(input_data, wave) {
  # pregnant. Ignore any responses if male (D1 == 1)
  if (all(c("D1b", "D1") %in% names(input_data))) {
    input_data$pregnant <- case_when(
      input_data$D1b == 1 ~ TRUE,
      input_data$D1b == 2 ~ FALSE,
      input_data$D1b == 4 ~ NA,
      input_data$D1 == 1 ~ NA,
      TRUE ~ NA
    )
  } else {
    input_data$pregnant <- NA
  }
  
  # smoker
  if ("D11" %in% names(input_data)) {
    input_data$smoker <- input_data$D11 == 1
  } else {
    input_data$smoker <- NA
  }
  
  # vaccine eligibility + priority vaccine-qualifying health conditions
  if ("C1" %in% names(input_data)) {
    comorbidities <- split_options(input_data$C1)
    
    input_data$comorbidheartdisease <- is_selected(comorbidities, "3")
    input_data$comorbidcancer <- is_selected(comorbidities, "2")
    input_data$comorbidkidneydisease <- is_selected(comorbidities, "7")
    input_data$comorbidlungdisease <- is_selected(comorbidities, "6")
    input_data$comorbiddiabetes <-
      is_selected(comorbidities, "1") |
      is_selected(comorbidities, "12") |
      is_selected(comorbidities, "10")
    input_data$comorbidimmuno <- is_selected(comorbidities, "11")
    input_data$comorbidobese <- is_selected(comorbidities, "13")

    # Combo vaccine-eligibility
    input_data$eligible <- 
      input_data$comorbidheartdisease |
      input_data$comorbidcancer |
      input_data$comorbidkidneydisease |
      input_data$comorbidlungdisease |
      input_data$comorbiddiabetes |
      input_data$comorbidimmuno
    
  } else {
    input_data$comorbidheartdisease <- NA
    input_data$comorbidcancer <- NA
    input_data$comorbidkidneydisease <- NA
    input_data$comorbidlungdisease <- NA
    input_data$comorbiddiabetes <- NA
    input_data$comorbidimmuno <- NA
    input_data$comorbidobese <- NA
    input_data$eligible <- NA
  }
  
  # Combo vaccine-eligibility updated to include smoking, pregnant, and obesity
  # status (added in Wave 8)
  if (all(c("eligible", "D1", "pregnant", "smoker", "comorbidobese") %in% names(input_data))) {
    # Fill in pregnant status with male gender as FALSE
    input_data$eligiblepregsmokeobese <-
      input_data$eligible |
      ifelse(input_data$D1 %in% 1, FALSE, input_data$pregnant) |
      input_data$smoker |
      input_data$comorbidobese
  } else {
    input_data$eligiblepregsmokeobese <- NA
  }
  
  return(input_data)
}

#' Vaccinated summary variable for making table cuts
#'
#' @param input_data input data frame of raw survey data
#' @param wave integer indicating survey version
#' 
#' @return augmented data frame
code_vaccinated_breakdown <- function(input_data, wave) {
  # grouping variable - vaccination status
  if (all(c("V1", "V3a", "V11a") %in% names(input_data))) {
    input_data$vaccinationstatus <- case_when(
      input_data$V1 == 1 ~ "Vaccinated",
      input_data$V3a == 1 ~ "Accept/Appointment",
      input_data$V3a == 2 ~ "Accept/Appointment",
      input_data$V11a == 1 ~ "Accept/Appointment",
      input_data$V3a == 3 ~ "Hesitant",
      input_data$V3a == 4 ~ "Hesitant",
      TRUE ~ NA_character_
    )
  } else if (all(c("V1", "V3") %in% names(input_data))) {
    input_data$vaccinationstatus <- case_when(
      input_data$V1 == 1 ~ "Vaccinated",
      input_data$V3 == 1 ~ "Accept/Appointment",
      input_data$V3 == 2 ~ "Accept/Appointment",
      input_data$V3 == 3 ~ "Hesitant",
      input_data$V3 == 4 ~ "Hesitant",
      TRUE ~ NA_character_
    )
  } else {
    input_data$vaccinationstatus <- NA
  }

  return(input_data)
}

#' COVID vaccination variables with modifications for contingency tables
#'
#' @param input_data input data frame of raw survey data
#' @param wave integer indicating survey version
#' 
#' @return data frame augmented with demographic grouping variables
code_addl_vaccines <- function(input_data, wave) {
  ## Items V3 and V4 display logic was changed mid-wave 6 to be shown only to
  ## respondents indicated that they had not been vaccinated. For the purposes
  ## of the contingency tables, we will ignore responses to V3 and V4 from
  ## before the change.
  if ("v_accept_covid_vaccine" %in% names(input_data)) {	
    input_data$v_accept_covid_vaccine[input_data$start_dt < wave6_mod_date] <- NA
  }

  # hesitant_vaccine
  # Percentage who would definitely or probably NOT choose to get vaccinated
  input_data$v_hesitant_vaccine <- NA
  if ("v_accept_covid_vaccine" %in% names(input_data)) {	
    input_data$v_hesitant_vaccine <- !input_data$v_accept_covid_vaccine
  }
  # post-Wave 11. No longer includes respondents with vaccine appointments
  if ("V3a" %in% names(input_data)) {
    input_data$v_hesitant_vaccine <- coalesce(
      input_data$v_hesitant_vaccine, input_data$V3a == 3 | input_data$V3a == 4
    )
  }

  # accept_vaccine_defyes
  # accept_vaccine_probyes
  # accept_vaccine_probno
  # accept_vaccine_defno
  input_data$v_accept_vaccine_defyes <- NA
  input_data$v_accept_vaccine_probyes <- NA
  input_data$v_accept_vaccine_probno <- NA
  input_data$v_accept_vaccine_defno <- NA
  # post-Wave 11. No longer include respondents with vaccine appointments.
  input_data$v_accept_vaccine_no_appointment_defyes <- NA
  input_data$v_accept_vaccine_no_appointment_probyes <- NA
  input_data$v_accept_vaccine_no_appointment_probno <- NA
  input_data$v_accept_vaccine_no_appointment_defno <- NA
  
  if ("V3" %in% names(input_data)) {
    input_data$V3[input_data$start_dt < wave6_mod_date] <- NA
    
    input_data$v_accept_vaccine_defyes <- input_data$V3 == 1
    input_data$v_accept_vaccine_probyes <- input_data$V3 == 2
    input_data$v_accept_vaccine_probno <- input_data$V3 == 3
    input_data$v_accept_vaccine_defno <- input_data$V3 == 4
  }
  if ("V3a" %in% names(input_data)) {	
    input_data$v_accept_vaccine_no_appointment_defyes <- input_data$V3a == 1
    input_data$v_accept_vaccine_no_appointment_probyes <- input_data$V3a == 2
    input_data$v_accept_vaccine_no_appointment_probno <- input_data$V3a == 3
    input_data$v_accept_vaccine_no_appointment_defno <- input_data$V3a == 4
  }
  
  if ( "V16" %in% names(input_data) ) {
    # introduced in Wave 11
    input_data$v_vaccine_timing_weeks <- input_data$V16 == 1
    input_data$v_vaccine_timing_onemonth <- input_data$V16 == 2
    input_data$v_vaccine_timing_threemonths <- input_data$V16 == 3
    input_data$v_vaccine_timing_sixmonths <- input_data$V16 == 4
    input_data$v_vaccine_timing_morethansix <- input_data$V16 == 5
    input_data$v_vaccine_timing_dontknow <- input_data$V16 == 6
  } else {
    input_data$v_vaccine_timing_weeks <- NA
    input_data$v_vaccine_timing_onemonth <- NA
    input_data$v_vaccine_timing_threemonths <- NA
    input_data$v_vaccine_timing_sixmonths <- NA
    input_data$v_vaccine_timing_morethansix <- NA
    input_data$v_vaccine_timing_dontknow <- NA
  }
  
  if ("B8" %in% names(input_data)) {
    input_data$t_ever_tested <- input_data$B8 == 1
  } else {
    input_data$t_ever_tested <- NA
  }
  
  return(input_data)
}

#' Trust in various individuals and organizations for recommendations and info
#'
#' @param input_data input data frame of raw survey data
#' @param wave integer indicating survey version
#' 
#' @return data frame augmented with demographic grouping variables
code_trust <- function(input_data, wave) {
  # Drop values in vaccine_likely_<source> prior to item change date in Wave 6
  # Percentage more likely to get vaccinated if recommended by <source>
  if ("v_vaccine_likely_friends" %in% names(input_data)) {	
    input_data$v_vaccine_likely_friends[input_data$start_dt < wave6_mod_date] <- NA
  }
  if ("v_vaccine_likely_local_health" %in% names(input_data)) {	
    input_data$v_vaccine_likely_local_health[input_data$start_dt < wave6_mod_date] <- NA
  }
  if ("v_vaccine_likely_who" %in% names(input_data)) {	
    input_data$v_vaccine_likely_who[input_data$start_dt < wave6_mod_date] <- NA
  }
  if ("v_vaccine_likely_govt_health" %in% names(input_data)) {	
    input_data$v_vaccine_likely_govt_health[input_data$start_dt < wave6_mod_date] <- NA
  }
  if ("v_vaccine_likely_politicians" %in% names(input_data)) {	
    input_data$v_vaccine_likely_politicians[input_data$start_dt < wave6_mod_date] <- NA
  }

  # hesitant_vaccine_likely_<source> (discontinued as of Wave 11)
  # Percentage more likely to get vaccinated if recommended by <source> among
  # those who are hesitant
  if (all(c("v_hesitant_vaccine", "v_vaccine_likely_friends") %in% names(input_data))) {
    input_data$v_hesitant_vaccine_likely_friends <- case_when(
      input_data$v_hesitant_vaccine == 1 & input_data$v_vaccine_likely_friends == 1 ~ 1,
      input_data$v_hesitant_vaccine == 1 & input_data$v_vaccine_likely_friends == 0 ~ 0,
      TRUE ~ NA_real_
    )
  } else {
    input_data$v_hesitant_vaccine_likely_friends <- NA_real_
  }
  
  if (all(c("v_hesitant_vaccine", "v_vaccine_likely_local_health") %in% names(input_data))) {
    input_data$v_hesitant_vaccine_likely_local_health <- case_when(
      input_data$v_hesitant_vaccine == 1 & input_data$v_vaccine_likely_local_health == 1 ~ 1,
      input_data$v_hesitant_vaccine == 1 & input_data$v_vaccine_likely_local_health == 0 ~ 0,
      TRUE ~ NA_real_
    )
  } else {
    input_data$v_hesitant_vaccine_likely_local_health <- NA_real_
  }
  
  if (all(c("v_hesitant_vaccine", "v_vaccine_likely_who") %in% names(input_data))) {
    input_data$v_hesitant_vaccine_likely_who <- case_when(
      input_data$v_hesitant_vaccine == 1 & input_data$v_vaccine_likely_who == 1 ~ 1,
      input_data$v_hesitant_vaccine == 1 & input_data$v_vaccine_likely_who == 0 ~ 0,
      TRUE ~ NA_real_
    )
  } else {
    input_data$v_hesitant_vaccine_likely_who <- NA_real_
  }
  
  if (all(c("v_hesitant_vaccine", "v_vaccine_likely_govt_health") %in% names(input_data))) {
    input_data$v_hesitant_vaccine_likely_govt <- case_when(
      input_data$v_hesitant_vaccine == 1 & input_data$v_vaccine_likely_govt_health == 1 ~ 1,
      input_data$v_hesitant_vaccine == 1 & input_data$v_vaccine_likely_govt_health == 0 ~ 0,
      TRUE ~ NA_real_
    )
  } else {
    input_data$v_hesitant_vaccine_likely_govt <- NA_real_
  }
  
  if (all(c("v_hesitant_vaccine", "v_vaccine_likely_politicians") %in% names(input_data))) {
    input_data$v_hesitant_vaccine_likely_politicians <- case_when(
      input_data$v_hesitant_vaccine == 1 & input_data$v_vaccine_likely_politicians == 1 ~ 1,
      input_data$v_hesitant_vaccine == 1 & input_data$v_vaccine_likely_politicians == 0 ~ 0,
      TRUE ~ NA_real_
    )
  } else {
    input_data$v_hesitant_vaccine_likely_politicians <- NA_real_
  }
  
  if (all(c("v_hesitant_vaccine", "v_vaccine_likely_doctors") %in% names(input_data))) {
    input_data$v_hesitant_vaccine_likely_doctors <- case_when(
      input_data$v_hesitant_vaccine == 1 & input_data$v_vaccine_likely_doctors == 1 ~ 1,
      input_data$v_hesitant_vaccine == 1 & input_data$v_vaccine_likely_doctors == 0 ~ 0,
      TRUE ~ NA_real_
    )
  } else {
    input_data$v_hesitant_vaccine_likely_doctors <- NA_real_
  }
  
  # Replacing set of hesitant_vaccine_likely_<source> indicators as of Wave 11
  if (all(c("v_hesitant_vaccine", "i_trust_covid_info_doctors") %in% names(input_data))) {
    input_data$i_hesitant_trust_covid_info_doctors <- case_when(
      input_data$v_hesitant_vaccine == 1 & input_data$i_trust_covid_info_doctors == 1 ~ 1,
      input_data$v_hesitant_vaccine == 1 & input_data$i_trust_covid_info_doctors == 0 ~ 0,
      TRUE ~ NA_real_
    )
  } else {
    input_data$i_hesitant_trust_covid_info_doctors <- NA_real_
  }
  
  if (all(c("v_hesitant_vaccine", "i_trust_covid_info_experts") %in% names(input_data))) {
    input_data$i_hesitant_trust_covid_info_experts <- case_when(
      input_data$v_hesitant_vaccine == 1 & input_data$i_trust_covid_info_experts == 1 ~ 1,
      input_data$v_hesitant_vaccine == 1 & input_data$i_trust_covid_info_experts == 0 ~ 0,
      TRUE ~ NA_real_
    )
  } else {
    input_data$i_hesitant_trust_covid_info_experts <- NA_real_
  }
  
  if (all(c("v_hesitant_vaccine", "i_trust_covid_info_cdc") %in% names(input_data))) {
    input_data$i_hesitant_trust_covid_info_cdc <- case_when(
      input_data$v_hesitant_vaccine == 1 & input_data$i_trust_covid_info_cdc == 1 ~ 1,
      input_data$v_hesitant_vaccine == 1 & input_data$i_trust_covid_info_cdc == 0 ~ 0,
      TRUE ~ NA_real_
    )
  } else {
    input_data$i_hesitant_trust_covid_info_cdc <- NA_real_
  }
  
  if (all(c("v_hesitant_vaccine", "i_trust_covid_info_govt_health") %in% names(input_data))) {
    input_data$i_hesitant_trust_covid_info_govt_health <- case_when(
      input_data$v_hesitant_vaccine == 1 & input_data$i_trust_covid_info_govt_health == 1 ~ 1,
      input_data$v_hesitant_vaccine == 1 & input_data$i_trust_covid_info_govt_health == 0 ~ 0,
      TRUE ~ NA_real_
    )
  } else {
    input_data$i_hesitant_trust_covid_info_govt_health <- NA_real_
  }
  
  if (all(c("v_hesitant_vaccine", "i_trust_covid_info_politicians") %in% names(input_data))) {
    input_data$i_hesitant_trust_covid_info_politicians <- case_when(
      input_data$v_hesitant_vaccine == 1 & input_data$i_trust_covid_info_politicians == 1 ~ 1,
      input_data$v_hesitant_vaccine == 1 & input_data$i_trust_covid_info_politicians == 0 ~ 0,
      TRUE ~ NA_real_
    )
  } else {
    input_data$i_hesitant_trust_covid_info_politicians <- NA_real_
  }
  
  if (all(c("v_hesitant_vaccine", "i_trust_covid_info_journalists") %in% names(input_data))) {
    input_data$i_hesitant_trust_covid_info_journalists <- case_when(
      input_data$v_hesitant_vaccine == 1 & input_data$i_trust_covid_info_journalists == 1 ~ 1,
      input_data$v_hesitant_vaccine == 1 & input_data$i_trust_covid_info_journalists == 0 ~ 0,
      TRUE ~ NA_real_
    )
  } else {
    input_data$i_hesitant_trust_covid_info_journalists <- NA_real_
  }
  
  if (all(c("v_hesitant_vaccine", "i_trust_covid_info_friends") %in% names(input_data))) {
    input_data$i_hesitant_trust_covid_info_friends <- case_when(
      input_data$v_hesitant_vaccine == 1 & input_data$i_trust_covid_info_friends == 1 ~ 1,
      input_data$v_hesitant_vaccine == 1 & input_data$i_trust_covid_info_friends == 0 ~ 0,
      TRUE ~ NA_real_
    )
  } else {
    input_data$i_hesitant_trust_covid_info_friends <- NA_real_
  }
  
  if (all(c("v_hesitant_vaccine", "i_trust_covid_info_religious") %in% names(input_data))) {
    input_data$i_hesitant_trust_covid_info_religious <- case_when(
      input_data$v_hesitant_vaccine == 1 & input_data$i_trust_covid_info_religious == 1 ~ 1,
      input_data$v_hesitant_vaccine == 1 & input_data$i_trust_covid_info_religious == 0 ~ 0,
      TRUE ~ NA_real_
    )
  } else {
    input_data$i_hesitant_trust_covid_info_religious <- NA_real_
  }
  
  return(input_data)
}

#' Vaccination barriers
#'
#' @param input_data input data frame of raw survey data
#' @param wave integer indicating survey version
#' 
#' @return data frame augmented with demographic grouping variables
code_vaccine_barriers <- function(input_data, wave) {
  # hesitant_worried_vaccine_sideeffects
  # Percentage very or moderately concerned about side effects among those who
  # are hesitant
  if (all(c("v_hesitant_vaccine", "v_worried_vaccine_side_effects") %in% names(input_data))) {
    input_data$v_hesitant_worried_vaccine_sideeffects <- case_when(
      input_data$v_hesitant_vaccine == 1 & input_data$v_worried_vaccine_side_effects == 1 ~ 1,
      input_data$v_hesitant_vaccine == 1 & input_data$v_worried_vaccine_side_effects == 0 ~ 0,
      TRUE ~ NA_real_
    )
  } else {
    input_data$v_hesitant_worried_vaccine_sideeffects <- NA_real_
  }

  # barrier_<reason>
  # Percentage of all respondents to V5a, V5b, and V5c who have X barrier to
  # choosing to get a COVID-19 vaccine
  # (# of respondents who selected X in any of V5a, V5b, V5c) / (# of
  # respondents who selected at least one option in any of V5a, V5b, V5c)
  # Created as v_hesitancy_reason_<source> in variables.R

  # hesitant_barrier_<reason>
  # Percentage of all hesitant respondents to V5 who have X barrier to choosing
  # to get a COVID-19 vaccine
  # (# of respondents who selected X in any of V5b, Vc) / (# of respondents who
  # selected at least one option in any of V5b, V5c)
  if (all(c("V5b", "V5c") %in% names(input_data))) {
    hesitancy_reasons <- coalesce(input_data$V5b, input_data$V5c)
    hesitancy_reasons <- split_options(hesitancy_reasons)
    
    input_data$v_hesitant_barrier_sideeffects <- is_selected(hesitancy_reasons, "1")
    input_data$v_hesitant_barrier_allergic <- is_selected(hesitancy_reasons, "2")
    input_data$v_hesitant_barrier_ineffective <- is_selected(hesitancy_reasons, "3")
    input_data$v_hesitant_barrier_dontneed <- is_selected(hesitancy_reasons, "4")
    input_data$v_hesitant_barrier_dislike_vaccines <- is_selected(hesitancy_reasons, "5")
    input_data$v_hesitant_barrier_not_recommended <- is_selected(hesitancy_reasons, "6")
    input_data$v_hesitant_barrier_wait_safety <- is_selected(hesitancy_reasons, "7")
    input_data$v_hesitant_barrier_low_priority <- is_selected(hesitancy_reasons, "8")
    input_data$v_hesitant_barrier_cost <- is_selected(hesitancy_reasons, "9")
    input_data$v_hesitant_barrier_distrust_vaccines <- is_selected(hesitancy_reasons, "10")
    input_data$v_hesitant_barrier_distrust_govt <- is_selected(hesitancy_reasons, "11")
    input_data$v_hesitant_barrier_health_condition <- is_selected(hesitancy_reasons, "12")
    input_data$v_hesitant_barrier_other <- is_selected(hesitancy_reasons, "13")
    input_data$v_hesitant_barrier_pregnant <- is_selected(hesitancy_reasons, "14")
    input_data$v_hesitant_barrier_religious <- is_selected(hesitancy_reasons, "15")
    
    # These response choices were removed starting in Wave 11. They are explicitly set to missing
    # for waves 11 and later since `is_selected` will return FALSE (meaning "not selected") for
    # them if the respondent selected at least once answer choice.
    input_data$v_hesitant_barrier_allergic[input_data$wave >= 11] <- NA
    input_data$v_hesitant_barrier_not_recommended[input_data$wave >= 11] <- NA
    input_data$v_hesitant_barrier_distrust_vaccines[input_data$wave >= 11] <- NA
    input_data$v_hesitant_barrier_health_condition[input_data$wave >= 11] <- NA
    input_data$v_hesitant_barrier_pregnant[input_data$wave >= 11] <- NA
    
  } else {
    input_data$v_hesitant_barrier_sideeffects <- NA
    input_data$v_hesitant_barrier_allergic <- NA
    input_data$v_hesitant_barrier_ineffective <- NA
    input_data$v_hesitant_barrier_dontneed <- NA
    input_data$v_hesitant_barrier_dislike_vaccines <- NA
    input_data$v_hesitant_barrier_not_recommended <- NA
    input_data$v_hesitant_barrier_wait_safety <- NA
    input_data$v_hesitant_barrier_low_priority <- NA
    input_data$v_hesitant_barrier_cost <- NA
    input_data$v_hesitant_barrier_distrust_vaccines <- NA
    input_data$v_hesitant_barrier_distrust_govt <- NA
    input_data$v_hesitant_barrier_health_condition <- NA
    input_data$v_hesitant_barrier_other <- NA
    input_data$v_hesitant_barrier_pregnant <- NA
    input_data$v_hesitant_barrier_religious <- NA
  }

  # defno_barrier_<reason>
  # Percentage of respondents who would definitely not choose to get vaccinated
  # AND who have X barrier to choosing to get a COVID-19 vaccine
  # (# of respondents who selected X in V5c) / (# of respondents who selected
  # at least one option in V5c)
  if ("V5c" %in% names(input_data)) {
    defno_reasons <- split_options(input_data$V5c)

    input_data$v_defno_barrier_sideeffects <- is_selected(defno_reasons, "1")
    input_data$v_defno_barrier_allergic <- is_selected(defno_reasons, "2")
    input_data$v_defno_barrier_ineffective <- is_selected(defno_reasons, "3")
    input_data$v_defno_barrier_dontneed <- is_selected(defno_reasons, "4")
    input_data$v_defno_barrier_dislike_vaccines <- is_selected(defno_reasons, "5")
    input_data$v_defno_barrier_not_recommended <- is_selected(defno_reasons, "6")
    input_data$v_defno_barrier_wait_safety <- is_selected(defno_reasons, "7")
    input_data$v_defno_barrier_low_priority <- is_selected(defno_reasons, "8")
    input_data$v_defno_barrier_cost <- is_selected(defno_reasons, "9")
    input_data$v_defno_barrier_distrust_vaccines <- is_selected(defno_reasons, "10")
    input_data$v_defno_barrier_distrust_govt <- is_selected(defno_reasons, "11")
    input_data$v_defno_barrier_health_condition <- is_selected(defno_reasons, "12")
    input_data$v_defno_barrier_other <- is_selected(defno_reasons, "13")
    input_data$v_defno_barrier_pregnant <- is_selected(defno_reasons, "14")
    input_data$v_defno_barrier_religious <- is_selected(defno_reasons, "15")

    # These response choices were removed starting in Wave 11. They are explicitly set to missing
    # for waves 11 and later since `is_selected` will return FALSE (meaning "not selected") for
    # them if the respondent selected at least once answer choice.
    input_data$v_defno_barrier_allergic[input_data$wave >= 11] <- NA
    input_data$v_defno_barrier_not_recommended[input_data$wave >= 11] <- NA
    input_data$v_defno_barrier_distrust_vaccines[input_data$wave >= 11] <- NA
    input_data$v_defno_barrier_health_condition[input_data$wave >= 11] <- NA
    input_data$v_defno_barrier_pregnant[input_data$wave >= 11] <- NA

  } else {
    input_data$v_defno_barrier_sideeffects <- NA
    input_data$v_defno_barrier_allergic <- NA
    input_data$v_defno_barrier_ineffective <- NA
    input_data$v_defno_barrier_dontneed <- NA
    input_data$v_defno_barrier_dislike_vaccines <- NA
    input_data$v_defno_barrier_not_recommended <- NA
    input_data$v_defno_barrier_wait_safety <- NA
    input_data$v_defno_barrier_low_priority <- NA
    input_data$v_defno_barrier_cost <- NA
    input_data$v_defno_barrier_distrust_vaccines <- NA
    input_data$v_defno_barrier_distrust_govt <- NA
    input_data$v_defno_barrier_health_condition <- NA
    input_data$v_defno_barrier_other <- NA
    input_data$v_defno_barrier_pregnant <- NA
    input_data$v_defno_barrier_religious <- NA
  }

# dontneed_reason_<reason>
  # Percentage of all respondents to (V5a, V5b, OR V5c) AND V6 who don’t
  # believe they need a COVID-19 vaccine for X reason
  # (# of respondents who selected “I don't believe I need a COVID-19 vaccine.”
  # in any of V5a, V5b, V5c) AND selected X in V6./ (# of respondents who
  # selected at least one option in any of V5a, V5b, V5c AND selected at least
  # one option in V6)
  if ("v_hesitancy_reason_unnecessary" %in% names(input_data)) {
    # v_hesitancy_reason_unnecessary is those who answered that they don't need the vaccine
    # to any of questions V5a, V5b, or V6c. It is created originally as
    # v_hesitancy_reason_unnecessary in variables.R.
    dontneed <- input_data$v_hesitancy_reason_unnecessary == 1

    if ("v_dontneed_reason_had_covid" %in% names(input_data)) {
      input_data$v_dontneed_reason_had_covid_5abc_6 <-
        all_true(dontneed, input_data$v_dontneed_reason_had_covid)
    } else {
      input_data$v_dontneed_reason_had_covid_5abc_6 <- NA
    }

    if ("v_dontneed_reason_dont_spend_time" %in% names(input_data)) {
      input_data$v_dontneed_reason_dont_spend_time_5abc_6 <-
        all_true(dontneed, input_data$v_dontneed_reason_dont_spend_time)
    } else {
      input_data$v_dontneed_reason_dont_spend_time_5abc_6 <- NA
    }

    if ("v_dontneed_reason_not_high_risk" %in% names(input_data)) {
      input_data$v_dontneed_reason_not_high_risk_5abc_6 <-
        all_true(dontneed, input_data$v_dontneed_reason_not_high_risk)
    } else {
      input_data$v_dontneed_reason_not_high_risk_5abc_6 <- NA
    }

    if ("v_dontneed_reason_precautions" %in% names(input_data)) {
      input_data$v_dontneed_reason_precautions_5abc_6 <-
        all_true(dontneed, input_data$v_dontneed_reason_precautions)
    } else {
      input_data$v_dontneed_reason_precautions_5abc_6 <- NA
    }

    if ("v_dontneed_reason_not_serious" %in% names(input_data)) {
      input_data$v_dontneed_reason_not_serious_5abc_6 <-
        all_true(dontneed, input_data$v_dontneed_reason_not_serious)
    } else {
      input_data$v_dontneed_reason_not_serious_5abc_6 <- NA
    }

    if ("v_dontneed_reason_not_beneficial" %in% names(input_data)) {
      input_data$v_dontneed_reason_not_beneficial_5abc_6 <-
        all_true(dontneed, input_data$v_dontneed_reason_not_beneficial)
    } else {
      input_data$v_dontneed_reason_not_beneficial_5abc_6 <- NA
    }

    if ("v_dontneed_reason_other" %in% names(input_data)) {
      input_data$v_dontneed_reason_other_5abc_6 <-
        all_true(dontneed, input_data$v_dontneed_reason_other)
    } else {
      input_data$v_dontneed_reason_other_5abc_6 <- NA
    }
  } else {
    input_data$v_dontneed_reason_had_covid_5abc_6 <- NA
    input_data$v_dontneed_reason_dont_spend_time_5abc_6 <- NA
    input_data$v_dontneed_reason_not_high_risk_5abc_6 <- NA
    input_data$v_dontneed_reason_precautions_5abc_6 <- NA
    input_data$v_dontneed_reason_not_serious_5abc_6 <- NA
    input_data$v_dontneed_reason_not_beneficial_5abc_6 <- NA
    input_data$v_dontneed_reason_other_5abc_6 <- NA
  }

  # hesitant_dontneed_reason_<reason>
  # Percentage of all hesitant respondents to V5 AND V6 who don’t believe
  # they need a COVID-19 vaccine for X reason
  # (# of respondents who selected “I don't believe I need a COVID-19 vaccine.”
  # in any of V5b, V5c) AND selected X in V6./ (# of respondents who selected
  # at least one option in any of V5b, V5c AND selected at least one option in
  # V6)
  if ("v_hesitant_barrier_dontneed" %in% names(input_data)) {
    dontneed <- input_data$v_hesitant_barrier_dontneed == 1
    
    if ("v_dontneed_reason_had_covid" %in% names(input_data)) {
      input_data$v_hesitant_dontneed_reason_had_covid <-
        all_true(dontneed, input_data$v_dontneed_reason_had_covid)
    } else {
      input_data$v_hesitant_dontneed_reason_had_covid <- NA
    }
    
    if ("v_dontneed_reason_dont_spend_time" %in% names(input_data)) {
      input_data$v_hesitant_dontneed_reason_dont_spend_time <-
        all_true(dontneed, input_data$v_dontneed_reason_dont_spend_time)
    } else {
      input_data$v_hesitant_dontneed_reason_dont_spend_time <- NA
    }
    
    if ("v_dontneed_reason_not_high_risk" %in% names(input_data)) {
      input_data$v_hesitant_dontneed_reason_not_high_risk <-
        all_true(dontneed, input_data$v_dontneed_reason_not_high_risk)
    } else {
      input_data$v_hesitant_dontneed_reason_not_high_risk <- NA
    }
    
    if ("v_dontneed_reason_precautions" %in% names(input_data)) {
      input_data$v_hesitant_dontneed_reason_precautions <-
        all_true(dontneed, input_data$v_dontneed_reason_precautions)
    } else {
      input_data$v_hesitant_dontneed_reason_precautions <- NA
    }
    
    if ("v_dontneed_reason_not_serious" %in% names(input_data)) {
      input_data$v_hesitant_dontneed_reason_not_serious <-
        all_true(dontneed, input_data$v_dontneed_reason_not_serious)
    } else {
      input_data$v_hesitant_dontneed_reason_not_serious <- NA
    }
    
    if ("v_dontneed_reason_not_beneficial" %in% names(input_data)) {
      input_data$v_hesitant_dontneed_reason_not_beneficial <-
        all_true(dontneed, input_data$v_dontneed_reason_not_beneficial)
    } else {
      input_data$v_hesitant_dontneed_reason_not_beneficial <- NA
    }
    
    if ("v_dontneed_reason_other" %in% names(input_data)) {
      input_data$v_hesitant_dontneed_reason_other <-
        all_true(dontneed, input_data$v_dontneed_reason_other)
    } else {
      input_data$v_hesitant_dontneed_reason_other <- NA
    }
  } else {
    input_data$v_hesitant_dontneed_reason_had_covid <- NA
    input_data$v_hesitant_dontneed_reason_dont_spend_time <- NA
    input_data$v_hesitant_dontneed_reason_not_high_risk <- NA
    input_data$v_hesitant_dontneed_reason_precautions <- NA
    input_data$v_hesitant_dontneed_reason_not_serious <- NA
    input_data$v_hesitant_dontneed_reason_not_beneficial <- NA
    input_data$v_hesitant_dontneed_reason_other <- NA
  }
  
  # defno_dontneed_reason_<reason>
  # Percentage of respondents who would definitely not choose to get vaccinated
  # AND who don’t believe they need a COVID-19 vaccine for X
  # reason
  # (# of respondents who selected “I don't believe I need a COVID-19 vaccine.”
  # in V5c) AND selected X in V6./ (# of respondents who selected at least one
  # option in V5c AND selected at least one option in V6)
  if ("v_defno_barrier_dontneed" %in% names(input_data)) {
    dontneed <- input_data$v_defno_barrier_dontneed == 1
    
    if ("v_dontneed_reason_had_covid" %in% names(input_data)) {
      input_data$v_defno_dontneed_reason_had_covid <-
        all_true(dontneed, input_data$v_dontneed_reason_had_covid)
    } else {
      input_data$v_defno_dontneed_reason_had_covid <- NA
    }
    
    if ("v_dontneed_reason_dont_spend_time" %in% names(input_data)) {
      input_data$v_defno_dontneed_reason_dont_spend_time <-
        all_true(dontneed, input_data$v_dontneed_reason_dont_spend_time)
    } else {
      input_data$v_defno_dontneed_reason_dont_spend_time <- NA
    }
    
    if ("v_dontneed_reason_not_high_risk" %in% names(input_data)) {
      input_data$v_defno_dontneed_reason_not_high_risk <-
        all_true(dontneed, input_data$v_dontneed_reason_not_high_risk)
    } else {
      input_data$v_defno_dontneed_reason_not_high_risk <- NA
    }
    
    if ("v_dontneed_reason_precautions" %in% names(input_data)) {
      input_data$v_defno_dontneed_reason_precautions <-
        all_true(dontneed, input_data$v_dontneed_reason_precautions)
    } else {
      input_data$v_defno_dontneed_reason_precautions <- NA
    }
    
    if ("v_dontneed_reason_not_serious" %in% names(input_data)) {
      input_data$v_defno_dontneed_reason_not_serious <-
        all_true(dontneed, input_data$v_dontneed_reason_not_serious)
    } else {
      input_data$v_defno_dontneed_reason_not_serious <- NA
    }
    
    if ("v_dontneed_reason_not_beneficial" %in% names(input_data)) {
      input_data$v_defno_dontneed_reason_not_beneficial <-
        all_true(dontneed, input_data$v_dontneed_reason_not_beneficial)
    } else {
      input_data$v_defno_dontneed_reason_not_beneficial <- NA
    }
    
    if ("v_dontneed_reason_other" %in% names(input_data)) {
      input_data$v_defno_dontneed_reason_other <-
        all_true(dontneed, input_data$v_dontneed_reason_other)
    } else {
      input_data$v_defno_dontneed_reason_other <- NA
    }
  } else {
    input_data$v_defno_dontneed_reason_had_covid <- NA
    input_data$v_defno_dontneed_reason_dont_spend_time <- NA
    input_data$v_defno_dontneed_reason_not_high_risk <- NA
    input_data$v_defno_dontneed_reason_precautions <- NA
    input_data$v_defno_dontneed_reason_not_serious <- NA
    input_data$v_defno_dontneed_reason_not_beneficial <- NA
    input_data$v_defno_dontneed_reason_other <- NA
  }
  
  return(input_data)
}

#' Attempts to get vaccinated
#'
#' @param input_data input data frame of raw survey data
#' @param wave integer indicating survey version
#' 
#' @return data frame augmented with demographic grouping variables
code_attempt_vaccine <- function(input_data, wave) {
  # informed_access
  # Percentage of respondents who are very or moderately informed about how to
  # get a vaccination
  # # very or moderately / # responses
  if ("V13" %in% names(input_data)) {
    input_data$v_informed_access <- case_when(
      input_data$V13 %in% c(1, 2) ~ 1,
      input_data$V13 %in% c(3, 4) ~ 0,
      TRUE ~ NA_real_
    )
  } else {
    input_data$v_informed_access <- NA_real_
  }
  
  # appointment_have (discontinued as of Wave 11)
  # Percentage of people who have an appointment to get a COVID-19 vaccine
  # conditional on being accepting
  if ("V11" %in% names(input_data)) {
    input_data$v_appointment_have <- input_data$V11 == 1
  } else {
    input_data$v_appointment_have <- NA
  }
  
  # appointment_tried (discontinued as of Wave 11)
  # Percentage of people without an appointment who have tried to get one
  # conditional on being accepting
  if ("V12" %in% names(input_data)) {
    input_data$v_appointment_tried <- input_data$V12 == 1
  } else {
    input_data$v_appointment_tried <- NA
  }
  
  # vaccine_tried
  # Percentage of people without an appointment who have tried to get a vaccine
  # conditional on being accepting
  if ("V12a" %in% names(input_data)) {
    # 1 = "yes", 2 = "no", no "I don't know" option
    input_data$v_vaccine_tried <- case_when(
      input_data$v_accept_covid_vaccine_no_appointment == 1 ~ input_data$V12a == 1,
      TRUE ~ NA
    )
  } else {
    input_data$v_vaccine_tried <- NA
  }
  
  return(input_data)
}

#' COVID symptoms with modifications for contingency tables
#'
#' @param input_data input data frame of raw survey data
#' @param wave integer indicating survey version
#' 
#' @return data frame augmented with demographic grouping variables
code_addl_symptoms <- function(input_data, wave) {
  # anosmia
  # Percentage of respondents experiencing anosmia
  # loss of taste or smell / # any B2 response
  if ("B2" %in% names(input_data)) {
    symptoms <- split_options(input_data$B2)
    
    input_data$symp_fever <- is_selected(symptoms, "1")
    input_data$symp_cough <- is_selected(symptoms, "2")
    input_data$symp_shortness_breath <- is_selected(symptoms, "3")
    input_data$symp_diff_breathing <- is_selected(symptoms, "4")
    input_data$symp_fatigue <- is_selected(symptoms, "5")
    input_data$symp_nasal_congestion <- is_selected(symptoms, "6")
    input_data$symp_runny_nose <- is_selected(symptoms, "7")
    input_data$symp_aches <- is_selected(symptoms, "8")
    input_data$symp_sore_throat <- is_selected(symptoms, "9")
    input_data$symp_chest_pain <- is_selected(symptoms, "10")
    input_data$symp_nausea <- is_selected(symptoms, "11")
    input_data$symp_diarrhea <- is_selected(symptoms, "12")
    input_data$symp_loss_smell_taste <- is_selected(symptoms, "13")
    input_data$symp_other <- is_selected(symptoms, "14")
    input_data$symp_none <- is_selected(symptoms, "15")
    input_data$symp_eye_pain <- is_selected(symptoms, "16")
    input_data$symp_chills <- is_selected(symptoms, "17")
    input_data$symp_headache <- is_selected(symptoms, "18")
    input_data$symp_sleep_changes <- is_selected(symptoms, "19")
    input_data$symp_stuffy_nose <- is_selected(symptoms, "20")
  } else {
    input_data$symp_fever <- NA
    input_data$symp_cough <- NA
    input_data$symp_shortness_breath <- NA
    input_data$symp_diff_breathing <- NA
    input_data$symp_fatigue <- NA
    input_data$symp_nasal_congestion <- NA
    input_data$symp_runny_nose <- NA
    input_data$symp_aches <- NA
    input_data$symp_sore_throat <- NA
    input_data$symp_chest_pain <- NA
    input_data$symp_nausea <- NA
    input_data$symp_diarrhea <- NA
    input_data$symp_loss_smell_taste <- NA
    input_data$symp_other <- NA
    input_data$symp_none <- NA
    input_data$symp_eye_pain <- NA
    input_data$symp_chills <- NA
    input_data$symp_headache <- NA
    input_data$symp_sleep_changes <- NA
    input_data$symp_stuffy_nose <- NA
  }
  
  calc_unusual_given_symptom <- function(symptom, unusual_symptom) {
    case_when(
      symptom & unusual_symptom ~ TRUE,
      symptom & !unusual_symptom ~ FALSE,
      TRUE ~ NA
    )
  }
  
  if ("B2c" %in% names(input_data)) {
    symptoms <- split_options(input_data$B2c)
    
    input_data$symp_fever_unusual <- calc_unusual_given_symptom(
      input_data$symp_fever, is_selected(symptoms, "1")
    )
    input_data$symp_cough_unusual <- calc_unusual_given_symptom(
      input_data$symp_cough, is_selected(symptoms, "2")
    )
    input_data$symp_shortness_breath_unusual <- calc_unusual_given_symptom(
      input_data$symp_shortness_breath, is_selected(symptoms, "3")
    )
    input_data$symp_diff_breathing_unusual <- calc_unusual_given_symptom(
      input_data$symp_diff_breathing, is_selected(symptoms, "4")
    )
    input_data$symp_fatigue_unusual <- calc_unusual_given_symptom(
      input_data$symp_fatigue, is_selected(symptoms, "5")
    )
    input_data$symp_nasal_congestion_unusual <- calc_unusual_given_symptom(
      input_data$symp_nasal_congestion, is_selected(symptoms, "6")
    )
    input_data$symp_runny_nose_unusual <- calc_unusual_given_symptom(
      input_data$symp_runny_nose, is_selected(symptoms, "7")
    )
    input_data$symp_aches_unusual <- calc_unusual_given_symptom(
      input_data$symp_aches, is_selected(symptoms, "8")
    )
    input_data$symp_sore_throat_unusual <- calc_unusual_given_symptom(
      input_data$symp_sore_throat, is_selected(symptoms, "9")
    )
    input_data$symp_chest_pain_unusual <- calc_unusual_given_symptom(
      input_data$symp_chest_pain, is_selected(symptoms, "10")
    )
    input_data$symp_nausea_unusual <- calc_unusual_given_symptom(
      input_data$symp_nausea, is_selected(symptoms, "11")
    )
    input_data$symp_diarrhea_unusual <- calc_unusual_given_symptom(
      input_data$symp_diarrhea, is_selected(symptoms, "12")
    )
    input_data$symp_loss_smell_taste_unusual <- calc_unusual_given_symptom(
      input_data$symp_loss_smell_taste, is_selected(symptoms, "13")
    )
    input_data$symp_eye_pain_unusual <- calc_unusual_given_symptom(
      input_data$symp_eye_pain, is_selected(symptoms, "16")
    )
    input_data$symp_chills_unusual <- calc_unusual_given_symptom(
      input_data$symp_chills, is_selected(symptoms, "17")
    )
    input_data$symp_headache_unusual <- calc_unusual_given_symptom(
      input_data$symp_headache, is_selected(symptoms, "18")
    )
    input_data$symp_sleep_changes_unusual <- calc_unusual_given_symptom(
      input_data$symp_sleep_changes, is_selected(symptoms, "19")
    )
    input_data$symp_stuffy_nose_unusual <- calc_unusual_given_symptom(
      input_data$symp_stuffy_nose, is_selected(symptoms, "20")
    )
  } else {
    input_data$symp_fever_unusual <- NA
    input_data$symp_cough_unusual <- NA
    input_data$symp_shortness_breath_unusual <- NA
    input_data$symp_diff_breathing_unusual <- NA
    input_data$symp_fatigue_unusual <- NA
    input_data$symp_nasal_congestion_unusual <- NA
    input_data$symp_runny_nose_unusual <- NA
    input_data$symp_aches_unusual <- NA
    input_data$symp_sore_throat_unusual <- NA
    input_data$symp_chest_pain_unusual <- NA
    input_data$symp_nausea_unusual <- NA
    input_data$symp_diarrhea_unusual <- NA
    input_data$symp_loss_smell_taste_unusual <- NA
    input_data$symp_eye_pain_unusual <- NA
    input_data$symp_chills_unusual <- NA
    input_data$symp_headache_unusual <- NA
    input_data$symp_sleep_changes_unusual <- NA
    input_data$symp_stuffy_nose_unusual <- NA
  }
  
  return(input_data)
}

#' Behaviors
#'
#' @param input_data input data frame of raw survey data
#' @param wave integer indicating survey version
#' 
#' @return augmented data frame
code_behaviors <- function(input_data, wave) {
  # direct_contact (discontinued as of Wave 11)
  # Percentage of respondents that have reported having had direct contact 
  # (longer than 5 minutes) with people not staying with them.
  # "respondent = someone who answered any of the four contact types
  # (responses to at least one contact type > 0) / # (responses to at least one
  # contact type)"
  if (all(c("C10_1_1", "C10_2_1",
            "C10_3_1", "C10_4_1") %in% names(input_data))) {
    input_data$c_direct_contact <- any_true(
      input_data$C10_1_1 > 0,
      input_data$C10_2_1 > 0,
      input_data$C10_3_1 > 0,
      input_data$C10_4_1 > 0
    )
  } else {
    input_data$c_direct_contact <- NA
  }
  
  return(input_data)
}

#' Activities
#'
#' @param input_data input data frame of raw survey data
#' @param wave integer indicating survey version
#' 
#' @return augmented data frame
code_addl_activities <- function(input_data, wave) {
  calc_masking_given_activity <- function(activity, masked_during_activity) {
    case_when(
      activity & masked_during_activity ~ TRUE,
      activity & !masked_during_activity ~ FALSE,
      TRUE ~ NA
    )
  }
  
  if ("C13a" %in% names(input_data)) {
    # introduced in wave 4
    activities <- split_options(input_data$C13a)
    
    input_data$a_mask_work_outside_home_1d <- calc_masking_given_activity(
      input_data$a_work_outside_home_1d, is_selected(activities, "1")
    )
    input_data$a_mask_shop_1d <- calc_masking_given_activity(
      input_data$a_shop_1d, is_selected(activities, "2")
    )
    input_data$a_mask_restaurant_1d <- calc_masking_given_activity(
      input_data$a_restaurant_1d, is_selected(activities, "3")
    )
    input_data$a_mask_spent_time_1d <- calc_masking_given_activity(
      input_data$a_spent_time_1d, is_selected(activities, "4")
    )
    input_data$a_mask_large_event_1d <- calc_masking_given_activity(
      input_data$a_large_event_1d, is_selected(activities, "5")
    )
    input_data$a_mask_public_transit_1d <- calc_masking_given_activity(
      input_data$a_public_transit_1d, is_selected(activities, "6")
    )
  } else {
    input_data$a_mask_work_outside_home_1d <- NA
    input_data$a_mask_shop_1d <- NA
    input_data$a_mask_restaurant_1d <- NA
    input_data$a_mask_spent_time_1d <- NA
    input_data$a_mask_large_event_1d <- NA
    input_data$a_mask_public_transit_1d <- NA
  }
  
  if ("C13c" %in% names(input_data)) {
    # introduced in wave 10 as "indoors" activities version of C13a
    activities <- split_options(input_data$C13c)
    
    input_data$a_mask_work_outside_home_indoors_1d <- calc_masking_given_activity(
      input_data$a_work_outside_home_indoors_1d, is_selected(activities, "1")
    )
    input_data$a_mask_shop_indoors_1d <- calc_masking_given_activity(
      input_data$a_shop_indoors_1d, is_selected(activities, "2")
    )
    input_data$a_mask_restaurant_indoors_1d <- calc_masking_given_activity(
      input_data$a_restaurant_indoors_1d, is_selected(activities, "3")
    )
    input_data$a_mask_spent_time_indoors_1d <- calc_masking_given_activity(
      input_data$a_spent_time_indoors_1d, is_selected(activities, "4")
    )
    input_data$a_mask_large_event_indoors_1d <- calc_masking_given_activity(
      input_data$a_large_event_indoors_1d, is_selected(activities, "5")
    )
    input_data$a_mask_public_transit_1d <- calc_masking_given_activity(
      input_data$a_public_transit_1d, is_selected(activities, "6")
    )
  } else {
    input_data$a_mask_work_outside_home_indoors_1d <- NA
    input_data$a_mask_shop_indoors_1d <- NA
    input_data$a_mask_restaurant_indoors_1d <- NA
    input_data$a_mask_spent_time_indoors_1d <- NA
    input_data$a_mask_large_event_indoors_1d <- NA
    input_data$a_mask_public_transit_1d <- NA
  }
  
  return(input_data)
}

