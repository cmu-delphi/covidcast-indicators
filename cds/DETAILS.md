# Corona Data Scraper Testing Data

We import the testing data from Corona Data Scraper and export
the county-level data as-is.  We also aggregate the data to the MSA, HRR, and
State levels.

In order to avoid confusing public consumers of the data, we maintain
consistency how CDS reports the data, please refer to [Exceptions](#Exceptions).

## Geographical Levels (`geo`)
* `county`: reported using zero-padded FIPS codes.  There are some exceptions
  that lead to inconsistency with the other COVIDcast data (but are necessary
  for internal consistency), noted below.  
* `msa`: reported using cbsa (consistent with all other COVIDcast sensors)
* `hrr`: reported using HRR number (consistent with all other COVIDcast sensors)
* `state`: reported using two-letter postal code

**Note that, we report msa/hrr level data based on county level information. 
As for state level data, we use county level aggregates for confirmed cases but 
state level data directly from the raw for tested.** This is because
the CDS testing data has a coverage over all states at state level, but not all states 
are represented at the county level. 

## Metrics, Level 1 (`m1`)
* `confirmed`: Number of confirmed cases
* `tested`: Number of tested cases

Recoveries and Deaths are _not_ reported.

## Metrics, Level 2 (`m2`)
* `new_counts`: number of new {confirmed cases, deaths} on a given day
* `cumulative_counts`: total number of {confirmed cases, deaths} up until the
  first day of data (January 22nd)
* `incidence`: `new_counts` / population * 100000

All three `m2` are ultimately derived from `cumulative_counts`, which is first
available on January 22nd.  In constructing `new_counts`, we take the first
discrete difference of `cumulative_counts`,  and assume that the
`cumulative_counts` for January 21st is uniformly zero.  

For deriving `incidence`, we use the estimated 2019 county population values
from the US Census Bureau.  https://www.census.gov/data/tables/time-series/demo/popest/2010s-counties-total.html

**We also report positivity rate according to confirmed incidence number and tested incidence number.**

## Exceptions
At the state and County (FIPS) level, we report the data _exactly_ as CDS reports their
data, to prevent confusing public consumers of the data. 
The visualization and modeling teams should take note of these exceptions.

### Ignored Areas at State Level
Due to the lack of population information, we ignore the four areas listed below:
|Name        |
|-------------------|
|Guam     |
|United States Virgin Islands           |
|Northern Mariana Islands              |
|Washington, D.C.          |

### Mismatched FIPS Codes

Finally, there are two FIPS codes that were changed in 2015, leading to
mismatch between us and CDS.  We report the data using the FIPS code used
by CDS, again to promote consistency and avoid confusion by external users
of the dataset.  For the mapping to MSA, HRR, these two counties are
included properly.

|County Name        |State          |"Our" FIPS         |CDS FIPS       |
|-------------------|---------------|-------------------|---------------|
|Oglala Lakota      |South Dakota   |46113              |46102          |
|Kusilvak           |Alaska         |02270              |02158          |

Documentation for the changes made by the US Census Bureau in 2015:
https://www.census.gov/programs-surveys/geography/technical-documentation/county-changes.html

## Negative incidence

Negative incidence is possible because figures are sometimes revised downwards, 
e.g., when a public health authority 
moves cases from County X to County Y, County X may have negative incidence. 
This is totally dependent on the quality of the raw dataset.

## Non-integral counts

Because the MSA and HRR numbers are computed by taking population-weighted
averages, the count data at those geographical levels may be non-integral.

## Infinity and negative positivity rate
The positivity rate is possible to be infinity or negative numbers due the problems in the
raw data. However, we _do not_ report those them to avoid unexplainatory numbers. Besides, we also
set a threshold `tested >= 50` when reporting the positivity rate.

## Counties not in our canonical dataset

Some FIPS codes do not appear as the primary FIPS for any ZIP code in our
canonical `02_20_uszips.csv`; they appear in the `county` exported files, but
for the MSA/HRR mapping, we disburse them equally to the counties with whom
they appear as a secondary FIPS code.  The identification of such "secondary"
FIPS codes are documented in `notebooks/create-mappings.ipynb`.  The full list
of `secondary, [mapped]` is:

```
SECONDARY_FIPS = [   # generated by notebooks/create-mappings.ipynb
	('51620', ['51093', '51175']),
	('51685', ['51153']),
	('28039', ['28059', '28041', '28131', '28045', '28059', '28109',
                    '28047']),
	('51690', ['51089', '51067']),
	('51595', ['51081', '51025', '51175', '51183']),
	('51600', ['51059', '51059', '51059']),
	('51580', ['51005']),
	('51678', ['51163']),
    ]
```
